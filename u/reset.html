<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<base href=".."/>
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/MVP.css" rel="stylesheet">
<title>Reset Password | ShareWave</title>



</head>

<body>
<div id="wrap">
    <div class="container">
       
       <div class="row-fluid">         
         	<section>   
                	<div class="span12 pagination-centered gateway">
                    	<div><img class="center loginLogo" src="img/logo-144x24.png"></div>
                        <form name="resetPasswordform" id="login" class="center" action="" method="post" onsubmit="doReset(); return false;">
                            <fieldset>
                                <label class="resetLabel headline2">Reset Your Password</label>
  								<div class="row-fluid">
  								<input class="loginInput" placeholder="New Password" autocomplete="off" id="newest_password" type="password" name="newPassword">
  
  								<div class="divInline hide" id="newPasswordAlert"> 
                                 <div class="alertpointerdiv"></div>
                                  <div class="textalert bodyText">
                                    <div class="alertContents">
                                          <img src="img/alert-icon.png">
                                          <span id="passwordRegexAlert" class="alertMessage"></span>
                                     </div>
                                  </div>  
                                 </div>
                                 </div>
                                 <div class="row-fluid"> 
  
  								<input class="loginInput" id="passwordconfirm" autocomplete="off" type="password" name="passwordconfirm" placeholder="Confirm Password"/>
								<div class="divInline hide" id="confirmPasswordAlert"> 
                                     <div class="alertpointerdiv"></div>
                                      <div class="textalert bodyText">
                                        <div class="alertContents">
                                              <img src="img/alert-icon.png">
                                              <span class="alertMessage">Passwords don't match</span>
                                         </div>
                                      </div>  
                                 </div>          
                                <br>
                                </div>
                                <button type="submit" class="button greenButton loginButton bodyText" autocomplete="off" tabindex="3">Change Password</button>
                                <br>
                            </fieldset>
                        </form>
                    </div>
        	</section>
    	</div>  
    </div>
  
  <div id="minimumGap"></div>
    <div id="push"></div>   
         </div>
         
         <div id="footer" class="footerBar">
          <div class="container"> 
            <footer> 
             <div class="row-fluid">
                <div class="span12 footerLinks">
                    <a class="menuHeaderText button">ABOUT</a>
                    <a class="menuHeaderText button">BLOG</a>
                    <a class="menuHeaderText button">CONTACT</a>
                    <a class="menuHeaderText button">TERMS</a>
                    <a class="menuHeaderText button">PRIVACY</a>
                  <div class="pull-right">
                   <a href="https://twitter.com/intent/tweet?text=A+beautifully+simple+way+to+organize%2C+visualize+and+communicate+with+investors+at&via=sharewaveteam&url=http://bit.ly/shwvtw"><img class="socialPlacement" src="img/twitter_v2.png" alt="Twitter Icon"></a>
                   <img class="socialPlacement" src="img/linkedin_v2.png" alt="LinkedIn Icon" onClick="window.open('http://www.linkedin.com/shareArticle?mini=true&url=http://bit.ly/shwvln&title=Sharewave%3A+Feed+Your+Investors&source=Sharewave&summary=A+beautifully+simple+way+to+organize%2C+visualize+and+communicate+with+investors','mywindow','width=500,height=400')">
                  </div>
                </div>
             </div>
             <div class="row-fluid" id="copyrightBar">
                <span class="menuHeaderText copyright">&copy; 2013 SHAREWAVE, ALL RIGHTS RESERVED</span>
             </div>
            </footer>
          </div>
        </div>
    <script src="script/jquery.js"></script>
    <script src="script/bootstrap.js"></script>
    <script src="brijj/brijj.js"></script>
    <script> 
	
	function getParams() {
	  var params = document.location.search.substring(1).split('&');
	  for (var i = 0; i < params.length; i++) {
		var param = params[i].split('=');
		params[unescape(param[0])] = unescape(param[1]);
	  }
	  return params;
	}
	
	function retrievedReset(x) {
			if (typeof x[1] === 'undefined' || x[1][1] === true) {
				alert("This is not a valid reset code, redirecting you to the login page");
				document.location.href = 'u/login.html';
			}
	  }
	
	function doReset() {
	   var p = document.querySelector("input[name=newPassword]").value;
	   var m = getParams();
	   var c = m['code'];
		if (p.match(/(?=.*?[a-z])(?=.*?[A-Z])(?=.*?[0-9]).{8,}/)) {
			jQuery("#newPasswordAlert").addClass("hide");
			if (document.querySelector("input[name=newPassword]").value === document.querySelector("input[name=passwordconfirm]").value)
			{
			jQuery("#confirmPasswordAlert").addClass("hide");
			SWBrijj.resetPassword(p,c).then(didReset).except(didntReset);
			}
			else {
			jQuery("#confirmPasswordAlert").removeClass("hide");
				
			}
		}
		else  {
			jQuery("#newPasswordAlert").removeClass("hide");
			var error = document.querySelector("#passwordRegexAlert");
			error.innerHTML = "Check the password requirements";
		}
	}
	
	function didReset(x) {
		  document.location.href = 'u/login.html';
	}
	
	function didntReset(x) {
	}
	
	$("#newest_password").focusout(function() {
		regexPassword()
	});
	
	$("#passwordconfirm").focusout(function() {
		checkPassword()
	});
	
	function checkPassword() {
    if (document.querySelector("input[name=passwordconfirm]").value) {
	  if (document.querySelector("input[name=newPassword]").value != document.querySelector("input[name=passwordconfirm]").value) {
		  jQuery("#confirmPasswordAlert").removeClass("hide");
	  }
	  else {
		  jQuery("#confirmPasswordAlert").addClass("hide");
	  }
	}
	else {
		  jQuery("#confirmPasswordAlert").addClass("hide"); 
	  }
  }
	
	function regexPassword() {
		var newP = document.querySelector("input[name=newPassword]").value;
		if (newP.match(/(?=.*?[a-z])(?=.*?[A-Z])(?=.*?[0-9]).{8,}/)) {
			jQuery("#newPasswordAlert").addClass("hide");
		}
		else if (newP.match(/(?=.*?[a-z])(?=.*?[A-Z]).{8,}/)) {
			jQuery("#newPasswordAlert").removeClass("hide");
			var error = document.querySelector("#passwordRegexAlert");
			error.innerHTML = "Missing a number";
		}
		else if (newP.match(/(?=.*?[a-z])(?=.*?[0-9]).{8,}/)) {
			jQuery("#newPasswordAlert").removeClass("hide");
			var error = document.querySelector("#passwordRegexAlert");
			error.innerHTML = "Missing an uppercase letter";
		}
		else if (newP.match(/(?=.*?[0-9])(?=.*?[A-Z]).{8,}/)) {
			jQuery("#newPasswordAlert").removeClass("hide");
			var error = document.querySelector("#passwordRegexAlert");
			error.innerHTML = "Missing a lowercase letter";
		}
		else  {
			jQuery("#newPasswordAlert").removeClass("hide");
			var error = document.querySelector("#passwordRegexAlert");
			error.innerHTML = "Check the password requirements";
		}
	}
	
	</script>
    <script>
   $(document).ready(function() {
	  var m = getParams();
	  var c = m['code']
	  if (c != undefined) {
		  SWBrijj.resetFillout(c).then(retrievedReset);
	  }
	  else {
		  document.location.href = 'u/login.html';
	  }
  });
  </script>
  </body>
</html>