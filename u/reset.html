<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<base href=".."/>
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<title>Reset Password | ShareWave</title>

<script> 
function checkPassword() { 

    if (document.resetPasswordForm.password.value != document.registerform.confirmpassword.value) { 
        document.resetPasswordForm.confirmpassword.setCustomValidity('Passwords must match.');
    } else {
    document.resetPasswordForm.confirmpassword.value.setCustomValidity('');
	}
} 

function getParams() {
  var params = document.location.search.substring(1).split('&');
  for (var i = 0; i < params.length; i++) {
    var param = params[i].split('=');
    params[unescape(param[0])] = unescape(param[1]);
  }
  return params;
}

function retrievedReset(x) {
		if (typeof x[1] === 'undefined' || x[1][1] === true) {
			alert("This is not a valid reset code, redirecting you to the login page");
			document.location.href = 'u/login.html';
		}
		else {
		document.getElementsByName('investoremail')[0].value = x[1][0];
		//document.getElementsByName('email')[0].value = x[1][2];
		}
  }

function doReset() {
   var p = document.querySelector("input[name=password]").value;
   var m = getParams();
   var c = m['code'];
   SWBrijj.resetPassword(p,c, [didReset, didntReset]);
}

function didReset(x) {
	  document.location.href = 'u/login.html';
}

function didntReset(x) {
	  alert("didntReset: "+x);
}
</script>

</head>

<body>
    <div class="container">
    	<div class="row-fluid">

            <section id="topbar">
        		<div class="span12" id="homenav">
        			<a href="index.html"><img src="img/logo2.png" id="homelogo" alt="ShareWave Logo"></a>
        			<div class="btn-toolbar pull-right">
        			<button class="btn btn-home" type="button" onclick="location.href='u/login.html'">Login</button>
            		<button class="btn btn-home btn-success" type="button" onclick="location.href='u/signup.html'">Sign Up</button>
            		</div>
        		</div>
    		</section>
        </div>
            
        <div class="row-fluid">
            <section id="corenav">
                <div class="span12 navbar">
                    <div>
                        <ul class="nav">
                        <li><a href="#">FOR COMPANIES</a></li>
                        <li><a href="#">FOR FUNDERS</a></li>
                        <li><a href="#">ABOUT US</a></li>
                        </ul>
                    </div>
                </div>   
            </section>
       </div>
       
       <div class="row-fluid">         
         	<section>   
                	<div class="span12 pagination-centered">
                    	<br>
                    	<h1>Reset Password</h1>
                        <form name="resetPasswordform" id="login" class="center" action="" method="post" onsubmit="doReset(); return false;">
                            <fieldset>
                            	
                                <label class="loginLabel">Email:</label> <input required class="loginInput" tabindex="1"
                autocapitalize="off" name="investoremail" type="text" disabled="true"> 
                
                                <label class="loginLabel">Password:</label>
                                <input required class="loginInput" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])\w{6,}" placeholder="password" id="password1" tabindex="4" name="password" type="password" onchange="this.setCustomValidity(this.validity.patternMismatch ? 'Password must contain at least 6 characters, including UPPER/lowercase and numbers' : '');
  if(this.checkValidity()) form.confirmpassword.pattern = this.value;">
  
                                <label class="loginLabel">Confirm Password:</label>
                                <input required class="loginInput" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])\w{6,}" id="register_password" placeholder="confirm password" tabindex="5" name="confirmpassword" type="password" onchange="
  this.setCustomValidity(this.validity.patternMismatch ? 'Please enter the same Password as above' : '');
">
                                <br>
                                <button type="submit" class="btn btn-success loginButton" tabindex="3">Reset</button>
                                <br>
                            </fieldset>
                        </form>
                    </div>
        	</section>
    	</div>  
    </div>
    <script src="script/jquery.js"></script>
    <script src="script/bootstrap.js"></script>
    <script src="brijj/brijj.js"></script>
    <script>
   $(document).ready(function() {
	  var m = getParams();
	  var c = m['code']
	  if (c != undefined) {
		  SWBrijj.resetFillout(c, retrievedReset);
	  }
	  else {
		  document.location.href = 'u/login.html';
	  }
  });
  </script>
  </body>
</html>