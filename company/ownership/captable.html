<div class="container">

  <div modal="capShare" close="close()" options="shareopts">
    <div class="modalHeader">
        <span data-icon="&#xe027;" aria-hidden="true">
        <p>Share Ownership Table</p>
    </div>
    
    <div>
      <form>
          <ul>
            <li>
              <input disabled class="checkbox" type="checkbox"></input>
              <span>Name</span>
              <span>Email</span>
            </li>
            <li ng-repeat="row in rows | shareList">
              <input class="checkbox" ng-model="row.send" type="checkbox"></input>
              <span class="capshareNames">{{row.name}}</span>
              <input ng-class="{'content':!row.email, 'error':emailCheck(row.send, row.email)}" ng-disabled="row.emailkey" ng-model="row.email"></input>
            </li>
          </ul>
          <p>All shareholders will only see their personal holdings and a summary row containing everyone else, you can change this by visiting a specific shareholder's profile</p>
      </form>
    </div>
    <div class="modalButtons">
        <button class="button subText greenButton" ng-click="close(); sendInvites();">Submit</button>

    </div>
  </div>

  <div modal="capMulti" close="mclose()" options="opts">
    <div class="modalHeader">
        <p class="subText">Is this a new transaction?</p>
    </div>
    
    <div class="modalText">
    <form>
        <p>Is this a new transaction, or do you want to modify the existing transaction?</p>
        <br>
        <select ng-model="pickTran" ng-options="i.datekey for i in activeTran"></select>
    </div>
    </form>
    <div class="modalButtons">
        <button class="button subText greyButton" ng-click="mclose(); mReset();">Undo</button>
        <button class="button subText greenButton" ng-click="mclose(); mComplete(pickTran, changedNum, changedType);">Complete</button>

    </div>
  </div>

  <div modal="capDelete" close="dclose()" options="opts">
    <div class="modalHeader">
        <p class="subText">Delete?</p>
    </div>
    
    <div class="modalText">
    <form>
        <p>Do you want to delete this issue, including all associated transactions?</p>
        <br>
    </div>
    </form>
    <div class="modalButtons">
      <button class="button subText greyButton" ng-click="dclose(); revertIssue(missue);">No</button>
      <button class="button subText greenButton" ng-click="dclose(); deleteIssue(missue);">Yes</button>

    </div>
  </div>

  <div modal="rowDelete" close="rclose()" options="opts">
    <div class="modalHeader">
        <p class="subText">Delete?</p>
    </div>
    
    <div class="modalText">
    <form>
        <p>Do you want to delete this shareholder, including all associated transactions?</p>
        <br>
    </div>
    </form>
    <div class="modalButtons">
        <button class="button subText greyButton" ng-click="rclose(); revertPerson(minvestor);">No</button>
        <button class="button subText greenButton" ng-click="rclose(); deletePerson(minvestor);">Yes</button>

    </div>
  </div>

  <div class="row-fluid leftTabWindow">
    <div ng-class="{leftFullTableBlock:toggleSide()}" class="span8 docLibrary leftBlock">
      <div class="headsection row-fluid">
        <h1>{{selected.name}}</h1>

        <div class="row-fluid">

          <ul class="bodyText maintabs">
            <li class="selectedtab">Ownership</li>
            <a href="/company/ownership/grant"><li class="button">Grants</li></a>
            <a href="/company/ownership/status"><li class="button">Status</li></a>
           </ul>
        </div>
      </div>

      <div class="row-fluid">
        <div class="subnav-controls">
          <div>
            <div class="pull-left">
              <div class="edittoggle btn-group">
                <button type="button" class="btn btn" ng-model="radioModel" btn-radio="'View'"><span data-icon="&#xe001;" aria-hidden="true"></button>
                <button type="button" class="btn btn" ng-model="radioModel" btn-radio="'Edit'"><span data-icon="&#xe00e;" aria-hidden="true"></button>
              </div>
            </div>
            <div class="pull-left namedtoggle">
              <p class="pull-left">DILUTION</p>
              <div class="pull-left onoffswitch">
                <input ng-disabled="!toggleView();" type="checkbox" ng-change="dilution();" ng-model="dilutionSwitch" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
                <label class="onoffswitch-label" for="myonoffswitch">
                  <div class="onoffswitch-inner"></div>
                  <div class="onoffswitch-switch"></div>
                </label>
              </div>
            </div>
            <div class="pull-left">
              <div class="minidrop btn-group">
                <button ng-click="modalUp();" class="btn"><span data-icon="&#xe027;" aria-hidden="true"></button>
              </div>
            </div>
          </div>
          <div class="DivHelper"></div>
        </div>
      </div>


      <div class="row-fluid capcontainer">
       <table class="captable tableView bodyText">
          <!-- Editable headers -->
          <tr ng-hide="toggleView();" class="column-label">
            <th colspan="2">Ownership</th>
            <th><span class="longrow">Shareholder</span></th>
            <th ng-repeat="one in issues">
              <input placeholder="new security name" class="capEditHeaders" ui-event="{focus : 'getActiveIssue(one)', blur : 'saveIssue(one)'}" ng-model="one.issue"></input>
            </th>
          </tr>
          <!-- Uneditable headers -->
          <tr ng-show="toggleView();" class="column-label">
            <th colspan="2">Ownership</th>
            <th><span class="longrow">Shareholder</span></th>
            <th class="staticHeaders" ng-repeat="one in issues" ng-click="getActiveIssue(one)">
              <span>{{one.issue}}</span>
            </th>
          </tr>
          <!-- Editable rows -->
          <tr ng-hide="toggleView();" ng-repeat="row in rows">
            <td class="capsums-col"><input disabled value="{{shareSum(row);}}"></input></td>
            <td class="capsums-col"><input disabled value="{{sharePercentage(row, rows, issuekeys) | number:3}}%"></input></td>
            <td>
              <span ng-switch on="row.nameeditable">
                <span ng-switch-default>
                  <input placeholder="NAME" style="width:180px;" ng-model="row.name" ng-change="nameChangeLR(row)" ui-event="{focus : 'getActiveInvestor(row)', blur : 'updateRow(row)'}"></input>
                </span>
                <span ng-switch-when="0">
                  <input disabled style="width:180px;" ng-model="row.name" ng-change="nameChangeLR(row)" ui-event="{focus : 'getActiveInvestor(row)', blur : 'updateRow(row)'}"></input>
                </span>
              </span>
            </td>
            <td ng-class="{tranSelected:row[key].state}" ng-repeat="key in issuekeys | orderBy:issueSort">
              <span ng-switch on="row.editable">
                <span ng-switch-default>
                  <input ng-class="{tranSelected:row[key].state}" class="captablepair" maxlength="18" placeholder="units" ui-event="{focus : 'getActiveTransaction(row.name, key)', blur : 'saveTran(activeTran)'}" ng-change="tranChangeU(row[key]['u'])" ng-model='row[key]["u"]'></input>
                  <input ng-class="{tranSelected:row[key].state}" class="captablepair" maxlength="18" placeholder="paid" ui-event="{focus : 'getActiveTransaction(row.name, key)', blur : 'saveTran(activeTran)'}" ng-change="tranChangeA(row[key]['a'])" ng-model='row[key]["a"]'></input>
                </span>
                <span ng-switch-when="0">
                  <input disabled class="captablepair" placeholder="units" ui-event="{focus : 'getActiveTransaction(row.name, key)', blur : 'saveTran(activeTran)'}" ng-change="tranChangeU(row[key]['u'])" ng-model='row[key]["u"]'></input>
                  <input disabled class="captablepair" placeholder="paid" ui-event="{focus : 'getActiveTransaction(row.name, key)', blur : 'saveTran(activeTran)'}" ng-change="tranChangeA(row[key]['a'])" ng-model='row[key]["a"]'></input>  
                </span>
              </span>
            </td>
          </tr>
          <!-- Un-editable view -->
          <tr ng-show="toggleView() && toggleDilution();" ng-repeat="row in rows">
            <td><input disabled value="{{shareSum(row);}}"></input></td>
            <td><input disabled value="{{sharePercentage(row, rows, issuekeys) | number:3}}%"></input></td>
            <td ng-click="getActiveInvestor(row);">{{row.name}}</td>
            <td ng-repeat="key in issuekeys | orderBy:issueSort">
                <p class="captablepair" ng-click="getActiveTransaction(row.name, key)">{{row[key]["u"]}}</p>
                <p class="captablepair" ng-click="getActiveTransaction(row.name, key)">{{row[key]["a"]}}</p>
            </td>
          </tr>
          <!-- Un-editable diluted view -->
          <tr ng-show="toggleView() && !toggleDilution();" ng-repeat="row in dilutedRows">
            <td><input disabled value="{{shareSum(row);}}"></input></td>
            <td><input disabled value="{{sharePercentage(row, dilutedRows, issuekeys) | number:3}}%"></input></td>
            <td ng-click="getActiveInvestor(row);">{{row.name}}</td>
            <td ng-repeat="key in issuekeys | orderBy:issueSort">
                <p class="captablepair" ng-click="getActiveTransaction(row.name, key)">{{row[key]["u"]}}</p>
                <p class="captablepair" ng-click="getActiveTransaction(row.name, key)">{{row[key]["a"]}}</p>
            </td>
          </tr>
          <!-- Undiluted footer -->
          <tr ng-show="toggleDilution();" class='tablefooter'>
            <td><input disabled value="{{totalShares(rows);}}"></input></td>
            <td><input disabled value="100.00%"></input></td>
            <td></td>
            <td ng-repeat="one in issues">
              <input class="captablepair" disabled value="{{colTotal(one.issue, rows, 'u');}}"</input>
              <input class="captablepair" disabled value="{{colTotal(one.issue, rows, 'a');}}"</input>
            </td>
          </tr>
          <!-- Diluted footer -->
          <tr ng-hide="toggleDilution();" class='tablefooter'>
            <td><input disabled value="{{totalShares(dilutedRows);}}"></input></td>
            <td><input disabled value="100.00%"></input></td>
            <td></td>
            <td ng-repeat="one in issues">
              <input class="captablepair" disabled value="{{colTotal(one.issue, dilutedRows, 'u');}}"</input>
              <input class="captablepair" disabled value="{{colTotal(one.issue, dilutedRows, 'a');}}"</input>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div ng-class="{rightNoTableBlock:toggleSide()}" class="span4 capright">
      <button type="button" class="btn" ng-model="sideToggle" ng-change="toggleSide();" btn-checkbox>Hide</button>
      <div class="row-fluid">
        <div ng-switch on="sideBar" >
          <span ng-switch-when="1">
            <div class="headsection row-fluid">
              <h2><input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.issue"></input></h2>
              <h2><input ng-disabled="toggleView();" ng-change="saveIssue(activeIssue)" type="text" ng-model="activeIssue.date" data-date-format="mm/dd/yyyy" bs-datepicker></h2>
            </div>

            <accordion close-others="true">
              <accordion-group heading="Valuation">
                <p>Pre Money<input ng-disabled="toggleView();" pattern="[0-9]*(.[0-9]*)*" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.premoney"></input></p>
                <p>Post Money<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.postmoney"></input></p>
                <p>Price Per Share<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.ppshare"></input></p>
                <p>Total Authorized<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.totalauth"></input></p>
                <p>Liquidation Preference
                  <select ng-disabled="toggleView();" ng-init="activeIssue.liquidpref" ng-change="saveIssue(activeIssue)" ng-model="activeIssue.liquidpref" ng-options="i for i in tf">
                  </select>
                </p>
                <p>Participating Preferred
                  <select ng-disabled="toggleView();" ng-init="activeIssue.partpref" ng-change="saveIssue(activeIssue)" ng-model="activeIssue.partpref" ng-options="i for i in tf">
                  </select>
                </p>
              </accordion-group>
              <span ng-show="trantype('options', activeIssue.atype);">
                <accordion-group heading="Options">
                  <p>Underlying Security
                    <select ng-disabled="toggleView();" ng-init="activeIssue.optundersec" ng-change="saveIssue(activeIssue)" ng-model="activeIssue.optundersec" ng-options="i for i in allowKeys">
                    <option></option>
                    </select>
                  </p>
                  <p>Price<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.price"></input></p>
                  <p>Granted <input disabled value="{{totalGranted(activeIssue.issue, trans);}}"></input></p>
                  <p>Term (months)<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.terms"></input></p>
                  <p>Vesting Cliff Date<input ng-disabled="toggleView();" ng-change="saveIssue(activeIssue)" type="text" ng-model="activeIssue.vestingbegins" data-date-format="mm/dd/yyyy" bs-datepicker></p>
                  <p>Vesting Cliff %<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.vestcliff"></input></p>
                  <p>Post Cliff Frequency
                    <select ng-disabled="toggleView();" ng-init="activeIssue.vestfreq" ng-change="saveIssue(activeIssue)" ng-model="activeIssue.vestfreq" ng-options="i for i in freqtypes">
                    </select>
                  </p>
                </accordion-group>
              </span>
              <span ng-show="trantype('debt', activeIssue.atype);">
                <accordion-group heading="Debt">
                  <p>Underlying Security
                    <select ng-init="activeIssue.debtundersec" ng-change="saveIssue(activeIssue)" ng-model="activeIssue.debtundersec" ng-options="i for i in allowKeys">
                    <option></option>
                    </select>
                  </p>
                  <p>Interest Rate<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.interestrate"></input></p>
                  <p>Valuation Cap<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.valcap"></input></p>
                  <p>Discount<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.discount"></input></p>
                  <p>Term<input ng-disabled="toggleView();" ui-event="{blur : 'saveIssue(activeIssue)'}" ng-model="activeIssue.term"></input></p>
                </accordion-group>
              </span>
            </accordion>
          </span>


          <span ng-switch-when="2">
            <div class="headsection row-fluid">
              <h2>{{activeInvestor}}<span ng-disabled="toggleView();" data-icon="&#xe00c;" ng-click="deletePersonButton(activeInvestor);" aria-hidden="true"></h2>
              <p>Customize terms for this shareholder</p>
            </div>
            <!-- <button ng-click="createTran();">Add</button> -->
            <tabset class="trantabs">
              <tab ng-repeat="tran in activeTran" heading="{{tran.date | date:'shortDate'}}" active="tran.active">
                <div class="row-fluid trancore">
                  <div>
                    <p>Date <input ng-disabled="toggleView();" ng-change="saveTranDate(tran)" type="text" ng-model="tran.date" data-date-format="mm/dd/yyyy" bs-datepicker></p>
                  </div>
                  <div class="DivHelper"></div>
                </div>
                <div class="row-fluid trancore">
                  <div>
                    <p>Paid $<input ng-disabled="toggleView();" ng-class="{'content':!tran.amount}" maxlength="18" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.amount"></input></p>
                    <p ng-hide="tran.forfeited">Shares<input ng-disabled="toggleView();" ng-class="{'content':!tran.units}" maxlength="18" class="signless" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.units"></input></p>
                  </div>
                  <div class="DivHelper"></div>
                </div>
                <div ng-show="tran.forfeited" class="row-fluid trancore">
                  <div>
                    <p>Shares<input ng-disabled="toggleView();" ng-class="{'content':!tran.units}" maxlength="18" class="signless" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.units"></input></p>
                    <p>Forfeit<input disabled ng-class="{'content':!tran.units}" maxlength="18" class="signless" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.forfeited"></input></p>
                  </div>
                  <div class="DivHelper"></div>
                </div>
                <!-- <button ng-click="manualdeleteTran(tran);">Delete</button> -->
                <accordion close-others="true">
                  <accordion-group heading="Valuation">
                    <p class="rightTitle"><span>Pre Money</span><input disabled pattern="[0-9]*(.[0-9]*)*" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.premoney"></input></p>
                    <p class="rightTitle"><span>Post Money</span><input disabled ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.postmoney"></input></p>
                    <p class="rightTitle"><span>Price Per Share</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.ppshare}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.ppshare"></input></p>
                    <p class="rightTitle"><span>Total Authorized</span><input disabled ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.totalauth"></input></p>
                    <p class="rightTitle"><span>Liquidation Preference</span>
                      <select ng-disabled="toggleView();" ng-init="tranIssue.liquidpref" ng-change="saveTran(tran)" ng-model="tran.liquidpref" ng-options="i for i in tf">
                      </select>
                    </p>
                    <p class="rightTitle"><span>Participating Preferred</span>
                      <select ng-disabled="toggleView();" ng-init="tran.partpref" ng-change="saveTran(tran)" ng-model="tran.partpref" ng-options="i for i in tf">
                      </select>
                    </p>
                  </accordion-group>
                  <span ng-show="trantype('options', tran.atype);">
                    <accordion-group heading="Options">
                      <p>Underlying Security
                        <select ng-disabled="toggleView();" ng-init="tran.optundersec" ng-change="saveTran(tran)" ng-model="tran.optundersec" ng-options="i for i in allowKeys">
                        <option></option>
                        </select>
                      </p>
                      <p class="rightTitle"><span>Price</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.price}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.price"></input></p>
                      <p class="rightTitle"><span>Term (months)</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.terms}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.terms"></input></p>
                      <p class="rightTitle"><span>Vesting Cliff Date</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.vestingbegins}" ng-change="saveTran(tran)" type="text" ng-model="tran.vestingbegins" data-date-format="mm/dd/yyyy" bs-datepicker></p>
                      <p class="rightTitle"><span>Vesting Cliff %</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.vestcliff}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.vestcliff"></input></p>
                      <p class="rightTitle"><span>Post Cliff Frequency</span>
                        <select ng-disabled="toggleView();" ng-init="tran.vestfreq" ng-change="saveTran(tran)" ng-model="tran.vestfreq" ng-options="i for i in freqtypes">
                        </select>
                      </p>
                    </accordion-group>
                  </span>
                  <span ng-show="trantype('debt', tran.atype);">
                      <accordion-group heading="Debt">
                        <p class="rightTitle"><span>Underlying Security</span>
                          <select ng-disabled="toggleView();" ng-init="tran.debtundersec" ng-change="saveTran(tran)" ng-model="tran.debtundersec" ng-options="i for i in allowKeys">
                          <option></option>
                          </select>
                        </p>
                        <p class="rightTitle"><span>Interest Rate</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.interestrate}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.interestrate"></input></p>
                        <p class="rightTitle"><span>Valuation Cap</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.valcap}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.valcap"></input></p>
                        <p class="rightTitle"><span>Discount</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.discount}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.discount"></input></p>
                        <p class="rightTitle"><span>Term</span><input ng-disabled="toggleView();" ng-class="{'content':!tran.term}" ui-event="{blur : 'saveTran(tran)'}" ng-model="tran.term"></input></p>
                      </accordion-group>
                    </span>
                </accordion>
              </tab>
              <tab select="createTrantab();" heading="add"></tab>
            </tabset>
          </span>

          <span ng-switch-when="3">
            <div class="headsection row-fluid">
              <h2>{{activeInvestorName}}</h2>
              <p>Info on this shareholder</p>
            </div>
            <div>
              <p>{{activeInvestorEmail}}</p>
            </div>
          </span>
          <span ng-switch-default>
            <div class="headsection row-fluid">
            </div>
            <p>Welcome To Your Captable</p>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
