<div class="maincontent openflow">
<div class="container dynamic-page doclistFlow">

<div class="row-fluid">
    <div class="headsection row-fluid">

        <ul class="maintabs head-text">
            <li class="selectedtab">Documents</li>
        </ul>
    </div>
    <div class="row-fluid">
        <div class="subnav-controls doclist-controls">
            <div>
                <div class="pull-left"
                     ng-hide="!hideSharebar"
                     ng-animate="{show:'fadeShow', hide:'fadeHide'}">
                    <span>VIEW BY</span>
                    <ul class="dropdown-list drop-selector">
                        <li class="dropdown standard">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                {{ viewBy | viewByPrinter }}
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a ng-click="setViewBy('document')" class="button">Document</a>
                                </li>
                                <li>
                                    <a ng-click="setViewBy('name')" class="button">Name</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="pull-left checkboxitem"
                     ng-hide="!hideSharebar"
                     ng-animate="{show:'fadeShow', hide:'fadeHide'}">
                    <span>HIDE COMPLETED</span>
                    <button class="check-box-button" ng-class="{'selected':maxRatio===2}" ng-click="toggleMaxRatio()">
                        <span data-icon="&#xe023;" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="pull-left">
                    <span>SEARCH</span>
                    <input type="text" class="search-box" ng-model="query">
                </div>

                <div class="box-button pull-right" ng-class="{selected:!hideSharebar}" ng-show="documents.length!==0" ng-click="toggleSide();">
                    <ul>
                        <li>
                            <span data-icon="&#xe024;" aria-hidden="true"></span>
                        </li>
                        <li>
                            <span>Share</span>
                        </li>
                    </ul>
                </div>
                <div class="box-button pull-right" ng-class="{selected: uploadModal}" ng-click="documentUploadOpen();">
                    <ul>
                        <li>
                            <span data-icon="&#xe053;" aria-hidden="true"></span>
                        </li>
                        <li>
                            <span>Add Files</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="DivHelper"></div>
        </div>
    </div>
</div>

<div class="row-fluid leftTabWindow">

<div ng-class="{leftFullTableBlock:hideSharebar, widthtransition25:oldSafari()}"
     class="span8 recipientInfo statusBlock leftBlock">
    <div class="row-fluid listcontainer">
        <table class="status-table" ng-show="documents.length===0 && viewBy==='document'">
            <tbody class="empty-table">
            <tr>
                <td>
                    <span>Welcome! </span><span class="link"
                                                ng-click="documentUploadOpen();">Upload a document</span><span> to get started.</span>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="status-table" ng-show="!investorDocs && viewBy==='name'">
            <tbody class="empty-table">
            <tr>
                <td>
                    <!-- todo update ng-click -->
                    <span>Welcome! </span><span class="link" ng-click="multishareOpen();">Share a document</span><span> to get started.</span>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="status-table" ng-show="documents.length!==0 && viewBy==='document'">
            <tbody>
            <tr>
                <th colspan="2" style="width: 50%" class="left doc-name-header" ng-click="setOrder('docname')">Document Name</th>
                <th colspan="2" ng-hide="!hideSharebar" ng-animate="{show:'fadeShow', hide:'fadeHide'}" class="left doc-status-header" ng-click="setOrder('statusRatio')">Status</th>
                <th></th>
            </tr>
            </tbody>
            <tbody ng-animate="'animate'" ng-repeat="doc in documents | filter:searchFilter | orderBy:docOrder">
            <tr class="empty-row"></tr>
            <tr ng-class="{selectedrow:doc.shown}">
                <td class="status-toggle"
                    ng-class="{'pointer':doc.versions[0]&&hideSharebar, 'status-toggle-on': doc.shown}"
                    ng-click="!doc.versions[0] || !hideSharebar || opendetails(doc)">
                    <div ng-switch on="hideSharebar">
                        <div ng-switch-when="true"
                             ng-animate="{show:'fadeShow', hide:'fadeHide'}"
                             ng-hide="!hideSharebar">
                            <span ng-hide="doc.shown || !doc.versions[0]"
                                  data-icon="&#xe017;" aria-hidden="true"></span>
                            <span ng-show="doc.shown && doc.versions[0]"
                                  data-icon="&#xe01c;" aria-hidden="true"></span>
                        </div>
                        <div ng-switch-when="false"
                             ng-animate="{show:'fadeShow', hide:'fadeHide'}"
                             ng-show="!hideSharebar">
                             <button class="check-box-button" ng-class="{selected:doc.forShare}" ng-click="toggleForShare(doc);">
                                 <span data-icon="&#xe023;" aria-hidden="true"></span>
                             </button>
                        </div>
                    </div>
                </td>
                <td class="shareholder-column docname-column" ng-click="viewStatus(doc)">
                    <ul>
                        <li>{{doc.docname | caplength:40}}</li>
                        <li ng-animate="{show:'fadeShow', hide:'fadeHide'}"
                            ng-hide="!hideSharebar">
                            {{docStatus(doc)}}
                        </li>
                    </ul>
                </td>
                <td ng-hide="!hideSharebar"
                    ng-animate="{show:'fadeShow', hide:'fadeHide'}"
                    class="status-toggle status-icon">
                    <div ng-show="docIsComplete(doc)" data-icon="&#xe023;" class="circle green"
                         aria-hidden="true"></div>
                    <div ng-hide="docIsComplete(doc)" class="circle"
                         ng-class="{gray:doc.versions.length===0, yellow:doc.versions.length>0}"></div>
                </td>
                <td ng-hide="!hideSharebar"
                    ng-animate="{show:'fadeShow', hide:'fadeHide'}"
                    class="shareholder-column status-column issuer pointer"
                    ng-click="viewStatus(doc)">
                    <ul>
                        <li>{{shortDocStatus(doc)}}</li>
                        <li>{{formatDocStatusRatio(doc)}}</li>
                    </ul>
                </td>
                <td>
                    <div ng-switch on="hideSharebar">
                        <div ng-switch-when="false"
                             ng-show="!hideSharebar && doc.forShare"
                             ng-animate="{show:'fadeShow', hide:'fadeHide'}">
                             <ul class="dropdown-list drop-selector">
                                 <li class="dropdown standard">
                                     <a class="dropdown-toggle" data-toggle="Dropdown" href="#">
                                         {{ formatShareType(getShareType(doc)) }}
                                     </a>
                                     <ul class="dropdown-menu">
                                         <li>
                                             <a class="button" ng-click="updateShareType(doc,0);">View Only</a>
                                         </li>
                                         <li ng-show="docIsPrepared(doc)">
                                             <a class="button" ng-click="updateShareType(doc,2);">Request Signature</a>
                                         </li>
                                         <li ng-show="!docIsPrepared(doc)">
                                             <a class="button" ng-click="prepareDocument(doc);">Prepare for Signature</a>
                                         </li>
                                         <li ng-show="docIsPrepared(doc)">
                                             <a class="button" ng-click="prepareDocument(doc);">Re-prepare for Signature</a>
                                         </li>
                                     </ul>
                                 </li>
                             </ul>
                         </div>
                         <div ng-switch-when="true"
                              ng-show="hideSharebar"
                              ng-animate="{show:'fadeShow', hide:'fadeHide'}">
                            <ul class="dropdown-list">
                                <li class="dropdown standard menu-drop">
                                    <a class="dropdown-toggle">
                                        <span data-icon="&#xe011;" aria-hidden="true"></span>
                                    </a>
                                    <ul ng-hide="toggleView();" class="dropdown-menu">
                                        <li ng-show="doc.doc_id" ng-click="viewStatus(doc)">View Status</li>
                                        <li ng-show="doc.doc_id || doc.template_id" ng-click="viewOriginal(doc)">View Original</li>
                                        <li ng-show="doc.doc_id" ng-click="exportOriginalToPdf(doc)">Export Original to PDF</li>
                                        <li ng-show="!doc.versions[0] && doc.doc_id" ng-click="updateTitleOpen(doc)">Rename</li>
                                        <li ng-show="!doc.versions[0] && doc.doc_id" ng-click="deleteDocOpen(doc)">Delete</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>
            <!-- TODO animate show/hide by sliding down/up -->
            <tr ng-show="doc.shown" class="sub-row" ng-repeat="version in doc.versions | orderBy:versionOrder">
                <td class="status-toggle"></td>
                <td class="shareholder-column docname-column" ng-click="viewInvestorCopy(version)">
                    <ul>
                        <li>{{version.name || version.investor}}</li>
                        <li>{{versionStatus(version)}}</li>
                    </ul>
                </td>
                <td class="status-toggle status-icon">
                    <div ng-show="versionIsComplete(version) && !version.when_retracted" data-icon="&#xe023;" class="circle green"
                         aria-hidden="true"></div>
                    <div ng-show="versionIsComplete(version) && version.when_retracted" class="circle green"
                        aria-hidden="true"><span>-</span></div>
                    <div ng-hide="versionIsComplete(version)" class="circle yellow" aria-hidden="true"></div>
                </td>
                <td class="shareholder-column status-column pointer" ng-click="viewStatus(doc)">
                    <ul>
                        <li>{{shortVersionStatus(version)}}</li>
                        <li>{{momentFromNow(version.last_event.event_time, version.last_event.timenow)}}</li>
                    </ul>
                </td>
                <td>
                    <div class="standard-button small-standard-button doc-share-button">
                        <!--<button ng-show="isPendingSignature(version) || isPendingView(version)" class="btn" ng-click="remind(version.doc_id,version.investor); console.log(doc);">Remind</button>-->
                        <button ng-show="isPendingCountersignature(version)" class="btn"
                                ng-click="viewInvestorCopy(version)">Sign
                        </button>
                        <button ng-show="isPendingIssuerFinalization(version)" class="btn"
                                ng-click="viewInvestorCopy(version)">Approve
                        </button>
                    </div>
                    <ul class="dropdown-list">
                        <li class="dropdown standard menu-drop">
                            <a class="dropdown-toggle dark">
                                <span data-icon="&#xe011;" aria-hidden="true"></span>
                            </a>
                            <ul ng-hide="toggleView();" class="dropdown-menu">
                                <li ng-show="!versionIsComplete(version)" ng-click="retractVersionOpen(version)">Retract</li>
                                <li ng-click="viewStatus(doc)">View Status</li>
                                <li ng-click="viewInvestorCopy(version)">View Document</li>
                                <!--<li ng-click="exportOriginalToPdf(doc)">Export Original to PDF</li>-->
                                <!--<li ng-show="navState.userid.indexOf('@sharewave.com')!==-1" ng-click="exportVersionToPdf(version)">Export Version to PDF</li>-->
                            </ul>
                        </li>
                    </ul>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="status-table" ng-show="investorDocs && viewBy==='name'">
            <tbody>
            <tr>
                <th colspan="2" class="left doc-name-header" ng-click="setInvestorOrder('name')">Name</th>
                <th colspan="2" class="left doc-status-header" ng-click="setInvestorOrder('statusRatio')">Status</th>
                <th></th>
            </tr>
            </tbody>
            <tbody ng-repeat="investor in investorDocs | filter:investorSearchFilter | orderBy:investorOrder">
            <tr class="empty-row"></tr>
            <tr ng-class="{selectedrow:investor.shown}">
                <td class="status-toggle"
                    ng-class="{'pointer':investor.versions[0], 'status-toggle-on':investor.shown}"
                    ng-click="!investor.versions[0] || opendetails(investor)">
                    <span ng-hide="investor.shown || !investor.versions[0]" data-icon="&#xe017;"
                          aria-hidden="true"></span>
                    <span ng-show="investor.shown && investor.versions[0]" data-icon="&#xe01c;"
                          aria-hidden="true"></span>
                </td>
                <td class="shareholder-column docname-column">
                    <ul>
                        <li>{{investor.name || investor.investor | caplength:40}}</li>
                        <li>{{docStatus(investor)}}</li>
                    </ul>
                </td>
                <td class="status-toggle status-icon">
                    <div ng-show="docIsComplete(investor)" data-icon="&#xe023;" class="circle green"
                         aria-hidden="true"></div>
                    <div ng-hide="docIsComplete(investor)" class="circle"
                         ng-class="{gray:investor.versions.length===0, yellow:investor.versions.length>0}"></div>
                </td>
                <td class="shareholder-column status-column issuer pointer">
                    <ul>
                        <li>{{shortDocStatus(investor)}}</li>
                        <li>{{formatDocStatusRatio(investor)}}</li>
                    </ul>
                </td>
                <td>
                    <ul ng-show="investor.name" class="dropdown-list">
                        <li class="dropdown standard menu-drop">
                            <a class="dropdown-toggle">
                                <span data-icon="&#xe011;" aria-hidden="true"></span>
                            </a>
                            <ul ng-hide="toggleView();" class="dropdown-menu">
                                <li ng-click="viewProfile(investor)">View Profile</li>
                            </ul>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr ng-show="investor.shown" class="sub-row"
                ng-repeat="version in investor.versions | orderBy:versionOrder">
                <td class="status-toggle"></td>
                <td class="shareholder-column docname-column" ng-click="viewInvestorCopy(version)">
                    <ul>
                        <li>{{version.docname}}</li>
                        <li>{{versionStatus(version)}}</li>
                    </ul>
                </td>
                <td class="status-toggle status-icon">
                    <div ng-show="versionIsComplete(version)" data-icon="&#xe023;" class="circle green"
                         aria-hidden="true"></div>
                    <div ng-hide="versionIsComplete(version)" class="circle yellow" aria-hidden="true"></div>
                </td>
                <td class="shareholder-column status-column pointer" ng-click="viewVersionStatus(version)">
                    <ul>
                        <li>{{shortVersionStatus(version)}}</li>
                        <li>{{momentFromNow(version.last_event.event_time, version.last_event.timenow)}}</li>
                    </ul>
                </td>
                <td>
                    <div class="standard-button small-standard-button doc-share-button">
                        <button ng-show="isPendingCountersignature(version)" class="btn"
                                ng-click="viewInvestorCopy(version)">Sign
                        </button>
                    </div>
                    <ul class="dropdown-list">
                        <li class="dropdown standard menu-drop">
                            <a class="dropdown-toggle dark">
                                <span data-icon="&#xe011;" aria-hidden="true"></span>
                            </a>
                            <ul ng-hiden="toggleView();" class="dropdown-menu">
                                <li ng-click="viewVersionStatus(version)">View Status</li>
                                <li ng-click="viewDoc(version.original)">View Document</li>
                                <!--<li ng-click="exportOriginalDocidToPdf(version.original)">Export Original to PDF</li>-->
                                <!--<li ng-click="exportVersionToPdf(version)">Export Version to PDF</li>-->
                            </ul>
                        </li>
                    </ul>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div ng-style="stretchheight"
     ng-class="{rightNoTableBlock:hideSharebar,
                showSharebar:!hideSharebar,
                slidingcss25:oldSafari()}"
     class="span4 capright button-offset">
    <h2 class="right-bar-header">SHARE DOCUMENTS</h1>
     <p>To share documents, check which documents you would like to share then add your contacts and a message below.</p>
     <div class="shareForm">
         <span>Recipients</span>
         <div class="sharepeople-input">
            <input ui-select2="select2Options" ng-model="docShareState.emails">
         </div>
         <span>Message</span>
         <textarea class="email-text" rows="4" cols="60" ng-model="messageText" ng-click="fakePlaceholder()"></textarea>
         <div class="controls">
             <div class="standard-button pull-right">
                 <button class="btn"
                         ng-click="shareDocuments(docShareState.doclist, docShareState.emails, messageText)"
                         ng-disabled="checkmany(docShareState.emails) || !docShareState.doclist.length>0">Share Documents</button>
             </div>
             <span class="pull-right pointer" ng-click="toggleSide();">Cancel</span>
         </div>
     </div>
</div>
</div>
</div>

<div modal="documentUploadModal" close="documentUploadClose()" options="narrowopts">
    <div class="modalHeader">
        <span>Upload Documents</span>
        <span class="close" data-icon="&#xe00f;" aria-hidden="true" ng-click="documentUploadClose()"></span>
    </div>

    <div class="modalText uploadModal">
        <p>Please select any document or presentation (20MB max per file)</p>
        <form class="form-inline">
            <fieldset>
                <!--
                <div ng-show="fileError" class="upload-errors">
                    <span>{{fileError}}</span>
                </div>
                -->
                <div class="fileinputs">
                    <input multiple ng-hide="showProgress || showProcessing" type="file" class='file'
                           onchange="angular.element(this).scope().setFiles(this);"/>

                    <div ng-hide="showProgress" class="fakefile">
                        <span>CHOOSE FILES</span>

                    </div>
                    <div ng-show="showProgress" class="progress-bar">
                        <progress percent="loadProgress"></progress>
                    </div>
                </div>
                <div ng-show="showProcessing" class="upload-errors">
                    <span>Processing Document</span>
                </div>
            </fieldset>
        </form>
        <div class="multiple-files" ng-show="files.length">
            <ul>
                <li ng-repeat="file in files">{{file.name | caplength:40}}</li>
            </ul>
        </div>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray">
            <button class="btn" ng-click="documentUploadClose()">Cancel</button>
        </div>
        <div class="standard-button green">
            <button class="btn"
                    ng-click="uploadFile(files)"
                    ng-disabled="files.length === 0">Upload</button>
        </div>
    </div>
</div>

<div modal="updateTitleModal" close="updateTitleClose()" options="opts">
    <div class="modalHeader">
        <span>Rename Document</span>
        <span class="close" data-icon="&#xe00f;" aria-hidden="true" ng-click="updateTitleClose()"></span>
    </div>
    <div class="modalText updateTitleModal">
        <input ng-model="docForModal.docname" type="text">
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray">
            <button class="btn" ng-click="updateTitleClose()">Cancel</button>
        </div>
        <div class="standard-button green">
            <button class="btn" ng-click="updateTitleClose()" ng-disabled="docForModal.docname.length < 1">Confirm
            </button>
        </div>
    </div>
</div>
<div modal="retractDocModal" close="retractVersionClose()" options="opts" class="updateTitleModal">
    <div class="modalHeader">
        <span>Retract Document</span>
        <span class="close" data-icon="&#xe00f;" aria-hiddden="true" ng-click="retractVersionClose()"></span>
    </div>
    <div class="modalText deleteDocModal">
        <span>Are you sure you want to retract {{docForModal.docname}} from {{docForModal.name || docForModal.investor}}?</span>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray">
            <button class="btn" ng-click="retractVersionClose()">Cancel</button>
        </div>
        <div class="standard-button green">
            <button class="btn" ng-click="retractVersion(docForModal); retractVersionClose();">Confirm</button>
        </div>
    </div>
</div>

<div modal="deleteDocModal" close="deleteDocClose()" options="opts" class="updateTitleModal">
    <div class="modalHeader">
        <span>Delete Document</span>
        <span class="close" data-icon="&#xe00f;" aria-hiddden="true" ng-click="deleteDocClose()"></span>
    </div>
    <div class="modalText deleteDocModal">
        <span>Are you sure you want to delete </span>
        <span>{{docForModal.docname}}?</span>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray">
            <button class="btn" ng-click="deleteDocClose()">Cancel</button>
        </div>
        <div class="standard-button green">
            <button class="btn" ng-click="reallyDeleteDoc(docForModal); deleteDocClose();">Confirm</button>
        </div>
    </div>
</div>

</div>
<div class="push"></div>
