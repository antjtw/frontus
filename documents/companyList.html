<div class="container dynamic-page doclistFlow">

  <div class="row-fluid">
  	<div class="headsection row-fluid">

        <ul class="maintabs head-text">
            <li class="selectedtab">Documents</li>
        </ul>
    </div>

    <div style="margin-left: 0;" class="span12 recipientInfo statusBlock">
        <div class="row-fluid">
            <div class="subnav-controls">
                <div>
                    <div class="pull-left">
                        <span>VIEW BY</span>
                        <ul class="dropdown-list drop-selector">
                            <li class="dropdown standard">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    {{ viewBy | viewByPrinter }}
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a ng-click="setViewBy('document')" class="button">Document</a>
                                    </li>
                                    <li>
                                        <a ng-click="setViewBy('investor')" class="button">Investor</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="pull-left checkboxitem">
                        <span>HIDE COMPLETED</span>
                        <button class="check-box-button" ng-class="{'selected':maxRatio===2}" ng-click="toggleMaxRatio()">
                            <span data-icon="&#xe023;" aria-hidden="true"></span>
                        </button> 
                    </div>
                    <div class="pull-left">
                        <span>SEARCH</span>
                        <input type="text" class="search-box" ng-model="query">
                    </div>

                    <div class="pull-right" ng-show="documents.length!==0">
                        <div class="standard-button">
                            <button ng-click="multishareOpen();" class="btn">Share
                            </button>
                        </div>
                    </div>
                    <div class="pull-right">
                        <div class="standard-button small-standard-button blue">
                            <button ng-click="documentUploadOpen();" class="btn">Upload
                            </button>
                        </div>
                    </div>

                </div>
                <div class="DivHelper"></div>
            </div>
            <table class="status-table" ng-show="documents.length===0 && viewBy==='document'">
                <tbody class="empty-table">
                    <tr>
                        <td>
                            <span>Welcome! </span><span class="link" ng-click="documentUploadOpen();">Upload a document</span><span> to get started.</span>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="status-table" ng-show="!investorDocs && viewBy==='investor'">
                <tbody class="empty-table">
                    <tr>
                        <td>
                            <span>Welcome! </span><span class="link" ng-click="multishareOpen();">Share a document</span><span> to get started.</span>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="status-table" ng-show="documents.length!==0 && viewBy==='document'">
                <tbody>
                    <tr>
                        <th colspan="2" class="left doc-name-header" ng-click="setOrder('docname')">Document Name</th>
                        <th colspan="2" class="left doc-status-header" ng-click="setOrder('statusRatio')">Status</th>
                        <th></th>
                    </tr>
                </tbody>
                <tbody ng-repeat="doc in documents | filter:searchFilter | orderBy:docOrder">
                    <tr class="empty-row"></tr>
                    <tr ng-class="{selectedrow:doc.shown}">
                        <td class="status-toggle"
                            ng-class="{'pointer':doc.versions[0], 'status-toggle-on': doc.shown}"
                            ng-click="!doc.versions[0] || opendetails(doc)">
                            <span ng-hide="doc.shown || !doc.versions[0]" data-icon="&#xe017;" aria-hidden="true"></span>
                            <span ng-show="doc.shown && doc.versions[0]" data-icon="&#xe01c;" aria-hidden="true"></span>
                        </td>
                        <td class="shareholder-column docname-column" ng-click="viewStatus(doc)">
                            <ul>
                                <li>{{doc.docname | caplength:40}}</li>
                                <li>{{docStatus(doc)}}</li>
                            </ul>
                        </td>
                        <td class="status-toggle status-icon">
                            <div ng-show="docIsComplete(doc)" data-icon="&#xe023;" class="circle green" aria-hidden="true"></div>
                            <div ng-hide="docIsComplete(doc)" class="circle" ng-class="{gray:doc.versions.length===0, yellow:doc.versions.length>0}"></div>
                        </td>
                        <td class="shareholder-column status-column issuer pointer" ng-click="viewStatus(doc)">
                            <ul>
                                <li>{{shortDocStatus(doc)}}</li>
                                <li>{{formatDocStatusRatio(doc)}}</li>
                            </ul>
                        </td>
                        <td>
                            <div class="standard-button small-standard-button gray doc-share-button">
                                <button class="btn" ng-click="shareDocOpen(doc)">Share</button>
                            </div>
                            <ul class="dropdown-list">
                                <li class="dropdown standard menu-drop">
                                    <a class="dropdown-toggle">
                                        <span data-icon="&#xe011;" aria-hidden="true"></span>
                                    </a>
                                    <ul ng-hide="toggleView();" class="dropdown-menu">
                                        <li ng-click="viewStatus(doc)">View Status</li>
                                        <li ng-click="viewOriginal(doc)">View Original</li>
                                        <li ng-click="exportOriginalToPdf(doc)">Export Original to PDF</li>
                                        <li ng-show="!doc.versions[0]" ng-click="updateTitleOpen(doc)">Rename</li>
                                        <!--<li ng-show="!doc.versions[0]" ng-click="deleteDocOpen(doc)">Delete</li>-->
                                    </ul>
                                </li>
                          </ul>
                        </td>
                    </tr>
                    <tr ng-show="doc.shown" class="sub-row" ng-repeat="version in doc.versions | orderBy:versionOrder">
                        <td class="status-toggle"></td>
                        <td class="shareholder-column docname-column" ng-click="viewInvestorCopy(version)">
                            <ul>
                                <li>{{version.name || version.investor}}</li>
                                <li>{{versionStatus(version)}}</li>
                            </ul>
                        </td>
                        <td class="status-toggle status-icon">
                            <div ng-show="versionIsComplete(version)" data-icon="&#xe023;" class="circle green" aria-hidden="true"></div>
                            <div ng-hide="versionIsComplete(version)" class="circle yellow" aria-hidden="true"></div>
                        </td>
                        <td class="shareholder-column status-column pointer" ng-click="viewStatus(doc)">
                            <ul>
                                <li>{{shortVersionStatus(version)}}</li>
                                <li>{{momentFromNow(version.last_event.event_time, version.last_event.timenow)}}</li>
                            </ul>
                        </td>
                        <td>
                            <div class="standard-button small-standard-button doc-share-button">
                                <!--<button ng-show="isPendingSignature(version) || isPendingView(version)" class="btn" ng-click="remind(version.doc_id,version.investor); console.log(doc);">Remind</button>-->
                                <button ng-show="isPendingCountersignature(version)" class="btn" ng-click="viewInvestorCopy(version)">Sign</button>
                            </div>
                            <ul class="dropdown-list">
                                <li class="dropdown standard menu-drop">
                                    <a class="dropdown-toggle dark">
                                        <span data-icon="&#xe011;" aria-hidden="true"></span>
                                    </a>
                                    <ul ng-hide="toggleView();" class="dropdown-menu">
                                        <li ng-click="viewStatus(doc)">View Status</li>
                                        <li ng-click="viewInvestorCopy(version)">View Version</li>
                                        <li ng-click="exportOriginalToPdf(doc)">Export Original to PDF</li>
                                        <!--<li ng-click="exportVersionToPdf(version)">Export Version to PDF</li>-->
                                    </ul>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="status-table" ng-show="investorDocs && viewBy==='investor'">
                <tbody>
                    <tr>
                        <th colspan="2" class="left doc-name-header" ng-click="setInvestorOrder('name')">Investor</th>
                        <th colspan="2" class="left doc-status-header" ng-click="setInvestorOrder('statusRatio')">Status</th>
                        <th></th>
                    </tr>
                </tbody>
                <tbody ng-repeat="investor in investorDocs | filter:investorSearchFilter | orderBy:investorOrder">
                    <tr class="empty-row"></tr>
                    <tr ng-class="{selectedrow:investor.shown}">
                        <td class="status-toggle"
                            ng-class="{'pointer':investor.versions[0], 'status-toggle-on':investor.shown}"
                            ng-click="!investor.versions[0] || openinvestordetails(investor)">
                            <span ng-hide="investor.shown || !investor.versions[0]" data-icon="&#xe017;" aria-hidden="true"></span>
                            <span ng-show="investor.shown && investor.versions[0]" data-icon="&#xe01c;" aria-hidden="true"></span>
                        </td>
                        <td class="shareholder-column docname-column" ng-click="viewProfile(investor)">
                            <ul>
                                <li>{{investor.name | caplength:40}}</li>
                                <li>{{docStatus(investor)}}</li>
                            </ul>
                        </td>
                        <td class="status-toggle status-icon">
                            <div ng-show="docIsComplete(investor)" data-icon="&#xe023;" class="circle green" aria-hidden="true"></div>
                            <div ng-hide="docIsComplete(investor)" class="circle" ng-class="{gray:investor.versions.length===0, yellow:investor.versions.length>0}"></div>
                        </td>
                        <td class="shareholder-column status-column issuer pointer" ng-click="viewProfile(investor)">
                            <ul>
                                <li>{{shortDocStatus(investor)}}</li>
                                <li>{{formatDocStatusRatio(investor)}}</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="dropdown-list">
                                <li class="dropdown standard menu-drop">
                                    <a class="dropdown-toggle">
                                        <span data-icon="&#xe011;" aria-hidden="true"></span>
                                    </a>
                                    <ul ng-hide="toggleView();" class="dropdown-menu">
                                        <li ng-click="viewProfile(investor)">View Profile</li>
                                    </ul>
                                </li>
                            </ul>
                        </td>
                    </tr>
                    <tr ng-show="investor.shown" class="sub-row" ng-repeat="version in investor.versions | orderBy:versionOrder">
                        <td class="status-toggle"></td>
                        <td class="shareholder-column docname-column" ng-click="viewInvestorCopy(version)">
                            <ul>
                                <li>{{version.docname}}</li>
                                <li>{{versionStatus(version)}}</li>
                            </ul>
                        </td>
                        <td class="status-toggle status-icon">
                            <div ng-show="versionIsComplete(version)" data-icon="&#xe023;" class="circle green" aria-hidden="true"></div>
                            <div ng-hide="versionIsComplete(version)" class="circle yellow" aria-hidden="true"></div>
                        </td>
                        <td class="shareholder-column status-column pointer">
                            <ul>
                                <li>{{shortVersionStatus(version)}}</li>
                                <li>{{momentFromNow(version.last_event.event_time, version.last_event.timenow)}}</li>
                            </ul>
                        </td>
                        <td>
                            <div class="standard-button small-standard-button doc-share-button">
                                <button ng-show="isPendingCountersignature(version)" class="btn" ng-click="viewInvestorCopy(version)">Sign</button>
                            </div>
                            <ul class="dropdown-list">
                                <li class="dropdown standard menu-drop">
                                    <a class="dropdown-toggle dark">
                                        <span data-icon="&#xe011;" aria-hidden="true"></span>
                                    </a>
                                    <ul ng-hiden="toggleView();" class="dropdown-menu">
                                        <li ng-click="viewDoc(version.original)">View Version</li>
                                        <li ng-click="exportOriginalDocidToPdf(version.original)">Export Original to PDF</li>
                                        <!--<li ng-click="exportVersionToPdf(version)">Export Version to PDF</li>-->
                                    </ul>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
  </div>
</div>

<div modal="documentUploadModal" close="documentUploadClose()" options="narrowopts">
    <div class="modalHeader">
        <span>Upload a document</span>
        <span class="close" data-icon="&#xe00f;" aria-hidden="true" ng-click="documentUploadClose()"></span>
    </div>

    <div class="modalText uploadModal">
        <p>Currently we're only taking PDF files (20MB max)</p>
        <form class="form-inline">
            <fieldset>
                <div ng-show="fileError" class="upload-errors">
                    <span>{{fileError}}</span>
                </div>
                <div class="fileinputs">
                    <input ng-hide="showProgress || showProcessing" type="file" class='file' onchange="angular.element(this).scope().setFiles(this);"/>
                    <div ng-hide="showProgress" class="fakefile">
                        <span>CHOOSE FILE</span>
                        <div ng-show="files.length">
                            <span>{{files[0].name | caplength:20}}</span>
                        </div>
                    </div>
                    <div ng-show="showProgress" class="progress-bar"><progress percent="loadProgress"></progress></div>
                </div>
                <div ng-show="showProcessing" class="upload-errors">
                    <span>Processing Document</span>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray">
            <button class="btn" ng-click="documentUploadClose()">Cancel</button>
        </div>
        <div class="standard-button green">
            <button class="btn" ng-click="uploadFile(files)">Upload</button>
        </div>
    </div>
</div>

<div modal="shareDocModal" close="shareDocClose()" options="opts">
    <div class="modalHeader">
        Share "{{docToShare.docname | caplength:35}}"
        <span class="close" data-icon="&#xe00f;" aria-hidden="true" ng-click="shareDocClose()"></span>
    </div>
    <div class="modalText dshare">
        <ul>
            <li>
                <span>Email Addresses</span>
                <div class="single-share-input">
                    <input ui-select2="select2Options" ng-model="recipient">
                </div>
            </li>
            <li>
                <span>Get Signature?</span>
                <ul class="dropdown-list drop-selector">
                    <li class="dropdown standard">
                        <a class="dropdown-toggle">
                            {{signeeded}}<span class="invisible-drop">'</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a ng-click="changeSig('No')">No</a>
                                <a ng-click="changeSig('Yes')">Yes</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <textarea class="email-text" rows="4" cols="60" ng-model="messageText" ng-click="fakePlaceholder()"></textarea>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray"><button class="btn" ng-click="shareDocClose()">Cancel</button></div>
        <div class="standard-button"><button class="btn" ng-disabled="checkmany(recipient);" ng-click="shareDocClose(); share(messageText, recipient, signeeded);">Confirm</button></div>
    </div>
</div>

<div modal="updateTitleModal" close="updateTitleClose()" options="opts">
    <div class="modalHeader">
        <span>Rename Document</span>
        <span class="close" data-icon="&#xe00f;" aria-hidden="true" ng-click="updateTitleClose()"></span>
    </div>
    <div class="modalText updateTitleModal">
        <input ng-model="docForModal.docname" type="text">
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray"><button class="btn" ng-click="updateTitleClose()">Cancel</button></div>
        <div class="standard-button green"><button class="btn" ng-click="updateTitleClose()" ng-disabled="docForModal.docname.length < 1">Confirm</button></div>
    </div>
</div>

<div modal="deleteDocModal" close="deleteDocClose()" options="opts" class="updateTitleModal">
    <div class="modalHeader">
        <span>Delete Document</span>
        <span class="close" data-icon="&#xe00f;" aria-hiddden="true" ng-click="deleteDocClose()"></span>
    </div>
    <div class="modalText deleteDocModal">
        <span>Are you sure you want to delete </span><br>
        <span>{{docForModal.docname}}?</span>
    </div>
    <div class="modal-footer">
        <div class="pull-left standard-button gray"><button class="btn" ng-click="deleteDocClose()">Cancel</button></div>
        <div class="standard-button red"><button class="btn" ng-click="deleteDocClose(doc)">Confirm</button></div>
    </div>
</div>

<div modal="multishareModal" close="multishareClose()" options="multishareopts">
    <div class="modalHeader">
        <span>Share Documents</span>
        <span class="close" data-icon="&#xe00f;" aria-hiddden="true" ng-click="multishareClose()"></span>
    </div>
    <div ng-show="sharemodalscreen == '1'" class="modalText">
        <span>Select the document(s) you want to share.</span>
        <ul>
            <li ng-repeat="doc in sharedocs | orderBy:shareOrder">
                <ul>
                    <li><button ng-class="{'selected':doc.picked}" ng-click="checkShareBox(doc, 'picked');" class="check-box-button"><span data-icon="&#xe023;" aria-hidden="true"></span></button></li>
                    <li>{{doc.docname  | caplength:40}}</li>
                    <li ng-show="doc.picked"><button ng-class="{'selected':doc.signature}" ng-click="checkShareBox(doc, 'signature');" class="check-box-button"><span data-icon="&#xe023;" aria-hidden="true"></span></button></li>
                    <li ng-show="doc.picked" class="capital-text">Signature?</li>
                </ul>
            </li>
        </ul>
    </div>
    <div ng-show="sharemodalscreen == '2'" class="modalText">
        <span>Add recipients for your selected documents.</span>
        <div class="sharepeople-input">
            <input ui-select2="select2Options" ng-model="multipeople">
        </div>
<!--        <ul>
            <li ng-repeat="person in sharePeople">
                <ul>
                    <li><button ng-class="{'selected':person.share}" ng-click="checkShareBox(person, 'share');" class="check-box-button"><span data-icon="&#xe023;" aria-hidden="true"></span></button></li>
                    <li>{{person.investor}}</li>
                </ul>
            </li>
        </ul>-->
    </div>
    <div class="modal-footer">
        <div ng-show="sharemodalscreen == '1'" class="pull-left standard-button gray"><button class="btn" ng-click="multishareClose()">Cancel</button></div>
        <div ng-show="sharemodalscreen == '1'" class="standard-button blue arrow-right"><button ng-disabled="!oneSelected(sharedocs, 'picked');" class="btn" ng-click="gotoscreen(2);">Select People</button></div>
        <div ng-show="sharemodalscreen == '2'" class="pull-left standard-button blue arrow-left"><button class="btn" ng-click="gotoscreen(1);">Back</button></div>
        <div ng-show="sharemodalscreen == '2'" class="standard-button green"><button class="btn" ng-disabled="checkmany(multipeople);" ng-click="sharetoMany(); multishareClose();">Send</button></div>
    </div>
</div>
