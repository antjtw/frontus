<link type="text/css" rel="stylesheet" href="/documents/css/app.css">
<script src="/cmn/spin.js"></script>
<div class="container dynamic-page">
    <subnav>
        <page-controls doc-id="docId" current-page="currentPage" ng-if="docId"></page-controls>
        <div class="pull-right">
            <button class="btn" ng-click="leave()">
                <span data-icon="&#xe602;" aria-hidden="true">
                    <span ng-if="prepareable()">Save &amp; </span>Exit
                </span>
            </button>
        </div>
    </subnav>
    <div modal="tourModal" close="tourclose();" options="touropts">
        <div class="modal-title">
            <p>
                How to Share Documents
            </p>
        </div>
        <div class="modalText">
            <div class="row-fluid">
                <div class="span6">
                    <img src="/img/gif/issuer-modal.gif">
                </div>
                <div class="span5 gif-text">
                    <p>
                        <span class="subtitle">Prepare your document for sharing</span>
                        Draw fields to mark where information can be entered. Fill out all your own fields prior to sending. The recipient will see everything but your signature, which is hidden until you approve their information.
                    </p>
                    <p class='blue-link'><span ng-click="tourclose(); sharinggot();">Ok, I got it!</span>&nbsp;<span data-icon="&#xe016;" aria-hidden="true"></span></p>
                </div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="companyDocViewer leftTabWindow" ng-style="viewportheight">
            <doc-viewer class="span8 leftBlock" ng-class="{leftFullTableBlock: toggleSide}" page-query-string="pageQueryString()" doc-id="docId"></doc-viewer>
            <internal-right-rail toggle-side="toggleSide">
                <tabset>
                    <tab heading="Annotations">
                        <annotation-list doc-id="docId" ng-if="docId"></annotation-list>
                    </tab>
                    <tab heading="Information">
                        <div class="docinfo">
                            <span class="activity-icon tags-icon"></span>
                            <span>{{doc.docname}}</span>
                            <hr>
                            <span class="activity-icon page-icon"></span>
                            <span ng-repeat="t in doc.tags">{{t}}</span>
                            <hr>
                        </div>
                    </tab>
                </tabset>
                <div class="bottom-part confirmPanelContainer">
                    <div class="confirmPanel">
                        <div ng-show="invq && doc.signable()">
                            <span>Do you want to electronically sign this document?</span>
                            <br>
                            <span>By clicking "Confirm", you are creating a legally binding contract between the other party and yourself, or the entity you are authorized to represent. This action is irreversible.</span>
                        </div>

                        <div ng-show="!invq && doc.countersignable($root.navState.role)">
                            <div class="upgradeWarning"
                                ng-if="triggerUpgradeDocuments(1)">
                                <span>
                                    Warning: Approving this document will automatically upgrade your payment plan.
                                </span>
                            </div>
                            <span>Approve Document with Electronic Signature</span>
                            <br>
                            <span>By clicking "Confirm", you are creating a legally binding contract between the other party and yourself, or the entity you are authorized to represent.</span>
                            <!-- ul class="radioOption">
                                <li class="pull-left">
                                    <button class="radio-button" ng-class="{'selected':confirmValue===-1}" ng-click="setConfirmValue(-1)"></button>
                                </li>
                                <li class="pull-left">
                                    <span>Reject Document</span>
                                    <br>
                                    <span>Reject signature on this document.</span>
                                    <br>
                                    <textarea ng-show="confirmValue===-1"
                                        class="messageText" rows="3"
                                        ng-model="$parent.rejectMessage"
                                        placeholder="Explain the reason for rejecting this document.">
                                    </textarea>
                                </li>
                            </ul -->
                        </div>

                        <div ng-show="!invq && doc.finalizable() && doc.signature_flow===1">
                            <div class="upgradeWarning"
                                ng-if="triggerUpgradeDocuments(1)">
                                <span>
                                    Warning: Approving this document will automatically upgrade your payment plan.
                                </span>
                            </div>
                            <span>Approve Document</span>
                            <br>
                            <span>Approve signature and finalize this document.</span>
                            <!-- ul class="radioOption">
                                <li class="pull-left">
                                    <button class="radio-button"
                                        ng-class="{'selected':confirmValue===-1}"
                                        ng-click="setConfirmValue(-1)">
                                    </button>
                                </li>
                                <li class="pull-left">
                                    <span>Reject Document</span>
                                    <br>
                                    <span>Reject signature on this document.</span>
                                    <br>
                                    <textarea ng-show="confirmValue===-1"
                                        class="messageText" rows="3"
                                        ng-model="$parent.rejectMessage"
                                        placeholder="Explain the reason for rejecting this document.">
                                    </textarea>
                                </li>
                            </ul -->
                        </div>
                        <div ng-show="invq && doc.voidable() && doc.signature_flow > 0">
                            <span>Accept Void</span>
                            <br>
                            <span>Accept the voiding of this document.</span>
                            <!--ul class="radioOption">
                                <li class="pull-left">
                                    <button class="radio-button"
                                        ng-class="{'selected':confirmValue===-1}"
                                        ng-click="setConfirmValue(-1)">
                                    </button>
                                </li>
                                <li class="pull-left">
                                    <span>Reject Void</span>
                                    <br>
                                    <span>Reject the voiding of this document.</span>
                                    <br>
                                    <textarea ng-show="confirmValue===-1"
                                        class="messageText" rows="3"
                                        ng-model="$parent.rejectMessage"
                                        placeholder="Explain the reason for rejecting this document.">
                                    </textarea>
                                </li>
                            </ul-->
                        </div>

                        <div ng-show="template_original && forsigning"> <!-- TODO: neither of these are set. Should be when invester is signing a smart doc -->
                            <span>Do you want to electronically sign this document?</span>
                            <br>
                            <span>(This action is irreversible.)</span>
                            <ul class="radioOption inline-radio">
                                <li>
                                    <span>Save Info?</span>
                                    <br>
                                    <span>Choose yes or no below if you want like to save all this information for other investor requests.
                                        You can access and change information in your investor profile.</span>
                                </li>
                                <br>
                                <li>
                                    <button class="radio-button" ng-class="{'selected':infoValue===1}" ng-click="setinfoValue(1)"></button>
                                </li>
                                <li>
                                    YES
                                </li>
                                <li>
                                    <button class="radio-button"
                                        ng-class="{'selected':infoValue===-1}"
                                        ng-click="setinfoValue(-1)">
                                    </button>
                                </li>
                                <li>
                                    NO
                                </li>
                            </ul>
                        </div>
                    </div> <!-- confirm panel -->
                    <div class="docViewerAction">
                        <div class="standard-button green confirmButton">
                            <button class="btn"
                                    ng-show="invq && doc.signable()"
                                    ng-disabled="processing"
                                    ng-click="signDocument(document, confirmValue);">
                                Confirm
                            </button>
                            <button class="btn"
                                    ng-show="!invq && doc.countersignable($root.navState.role)"
                                    ng-disabled="processing"
                                    ng-click="countersignDocument();">
                                Confirm
                            </button>
                            <button class="btn"
                                    ng-show="!invq && doc.finalizable()"
                                    ng-disabled="processing"
                                    ng-click="finalizeDocument();">
                                Confirm
                            </button>
                            <button class="btn"
                                    ng-show="invq && doc.voidable()"
                                    ng-disabled="processing || confirmValue===0"
                                    ng-click="voidAction(confirmValue, rejectMessage);">
                                Confirm
                            </button>
                            <button class="btn"
                                    ng-show="template_original && !forsigning"
                                    ng-disabled="processing || checkmany(template_email)"
                                    ng-click="template_share(template_email, used_attributes, template_message, true, '22 November 2113');">
                                Send
                            </button>
                            <button class="btn"
                                    ng-disabled="!confirmValue"
                                    ng-show="template_original && forsigning"
                                    ng-click="signTemplate(investor_attributes, infoValue, confirmValue)">
                                Sign
                            </button>
                        </div>
                    </div>

                </div>
            </internal-right-rail>
        </div>
    </div>
</div>

<div modal="imageProcessedModal" options="processedopts" data-keyboard="false" data-backdrop="static">
    <div class="row-fluid">
        <div class="span7">
            <div class="row-fluid">
                <div class="rect leftOffset" ng-class="adjustedColor" ng-click="selectProcessing('adjusted')">
                    <img id="processedModalAdjustedImage">
                    <div class="modalText centeredText" ng-class="adjustedText">
                        <span>Enhanced</span>
                    </div>
                </div>
                <div class="rect" ng-class="originalColor" ng-click="selectProcessing('original')">
                    <img id="processedModalOriginalImage">
                    <div class="modalText centeredText" ng-class="originalText">
                        <span>Original</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="span5">
            <div class="modalText">
                <div class="textBlock">
                    <span class="subtitle">We fixed it!</span>
                    <span>We've straightened up your document to make it look better!<span>
                </div>
                <div class='blue-link' ng-if="adjustedSelected"><span ng-click="processedClose(false)">Continue with enhancements</span>&nbsp;<span class="dataIcon" data-icon="&#xe016;" aria-hidden="true"></span></div>
                <div class='blue-link' ng-if="!adjustedSelected"><span ng-click="processedClose(true)">Continue with original</span>&nbsp;<span class="dataIcon" data-icon="&#xe016;" aria-hidden="true"></span></div>
            </div>
        </div>
    </div>
</div>
