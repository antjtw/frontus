<link type="text/css" rel="stylesheet" href="/documents/css/app.css">
<script src="/cmn/spin.js"></script>
<div class="container dynamic-page">
    <subnav>
        <div ng-if="(navState.role == 'issuer') && drawTime() && doc.issue">
            <div class="toggle-button pull-left"
                 ng-click="setNextAnnotationType('text');"
                 data-placement="bottom"
                 ng-class="{selected: nextAnnotationType == 'text'}">
                <ul>
                    <li>
                        <span data-icon="&#xe60d;" aria-hidden="true"></span>
                        <span>Marker</span>
                    </li>
                </ul>
            </div>
            <div class="toggle-button pull-left"
                 ng-click="setNextAnnotationType('highlight');"
                 data-placement="bottom"
                 ng-class="{selected:  nextAnnotationType == 'highlight'}">
                <ul>
                    <li>
                        <span data-icon="&#xe60f;" aria-hidden="true"></span>
                        <span>Highlight</span>
                    </li>
                </ul>
            </div>
        </div>
        <page-controls doc-id="docId" current-page="currentPage" ng-if="docId"></page-controls>
        <div ng-hide="prepareFor" class="box-button pull-right"
             ng-click="$root.leave();"
             data-placement="bottom">
            <ul>
                <li>
                    <span data-icon="&#xe602;" aria-hidden="true"></span>
                </li>
                <li>
                    <span><span ng-if="prepareable() || prepareFor || actionNeeded()">Save &amp; </span>Exit</span>
                </li>
            </ul>
        </div>
        <div class="box-button pull-right"
             ng-class="{'disabledme': companyIsZombie()}"
             ng-show="!invq && !urlInves && !prepareable() && !prepareFor"
             ng-click="companyIsZombie() || shareThisDoc();"
             tooltip-placement="bottom" tooltip="{{zombiemessage}}">
            <ul>
                <li> <span data-icon="&#xe604;" aria-hidden="true"></span>

                </li>
                <li> <span>Share</span>

                </li>
            </ul>
        </div>
        <div ng-show="!prepareFor && !prepareable()" class="box-button pull-right"
             ng-click="downloadPDF();"
             data-placement="bottom">
            <ul>
                <li>
                    <span data-icon="&#xe007;" aria-hidden="true"></span>
                </li>
                <li>
                    <span>Download</span>
                </li>
            </ul>
        </div>
    </subnav>
    <div class="row-fluid">
        <div class="leftTabWindow" ng-style="viewportheight">
            <doc-viewer class="span8 leftBlock" ng-class="{leftFullTableBlock: toggleSide, widthtransition25:oldSafari()}" page-query-string="pageQueryString()" doc-id="docId" investor_attributes="investor_attributes"></doc-viewer>
            <internal-right-rail toggle-side="toggleSide">
                <tabset>
                    <tab active="infotab" heading="Information">
                        <div class="docinfo">
                            <div class="docname" ng-if="doc.docname">
                                <span>{{doc.docname}}</span>
                            </div>
                            <div class="inforow" ng-if="doc.tags.length > 0">
                                <span class="activity-icon tags-icon"></span>
                                <span class="tags">
                                    <span ng-repeat="t in doc.tags">{{t}}</span>
                                </span>
                            </div>
                            <div class="inforow" ng-if="prepareFor">
                                <span class="activity-icon people-icon"></span>
                                <span class="info"><span>{{prepareFor}}</span><span>Preparing for</span></span>
                            </div>
                            <div class="inforow" ng-if="doc.when_shared">
                                <span class="activity-icon doc-share-icon"></span>
                                <span class="info" ng-if="navState.role == 'issuer'"><span>Delivered to {{doc.name}}</span><span>{{doc.when_shared  | date:settings.dateandtime}}</span></span>
                                <span class="info" ng-if="navState.role == 'investor'"><span>Received</span><span>{{doc.when_shared  | date:settings.dateandtime}}</span></span>
                            </div>
                            <div class="inforow" ng-if="sendgrid.when_email_opened && doc.when_shared">
                                <span class="activity-icon received-icon"></span>
                                <span class="info" ng-if="navState.role == 'issuer'"><span>Opened email</span><span>{{sendgrid.when_email_opened  | date:settings.dateandtime}}</span></span>
                            </div>
                            <div class="inforow" ng-if="doc.last_viewed && navState.role == 'issuer'">
                                <span class="activity-icon doc-view-icon"></span>
                                <span class="info"><span>Viewed by {{doc.name}}</span><span>{{docviews.minimum  | date:settings.dateandtime}}</span></span>

                                <div class="investor-views" ng-if="doc.last_viewed && navState.role == 'issuer'">
                                    <span class="toggle-icon" data-icon="&#xe034;"aria-hidden="true" ng-show="!showViews" ng-click = "showViews = !showViews"></span>
                                    <span class="toggle-icon" data-icon="&#xe031;"aria-hidden="true" ng-show="showViews" ng-click = "showViews = !showViews"></span>
                                    <span ng-click = "showViews = !showViews">Detailed Views</span>
                                    <ul ng-show="showViews">
                                        <li ng-repeat="view in docviews" ng-if="view.page > 0 && view.page <= doc.pages.length">
                                            <span>Page {{view.page}}</span>
                                            <span>{{view.max | date:settings.dateandtime}}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="inforow" ng-if="doc.when_signed">
                                <span class="activity-icon doc-sign-icon"></span>
                                <span class="info" ng-if="navState.role == 'issuer'">
                                    <span ng-if="!doc.when_signature_provided">Signed by {{doc.name}}</span>
                                    <span ng-if="doc.when_signature_provided">Signed offline and uploaded</span>
                                    <span>{{doc.when_signed  | date:settings.dateandtime}}</span>
                                </span>
                                <span class="info" ng-if="navState.role == 'investor'">
                                    <span ng-if="!doc.when_signature_provided">Signed</span>
                                    <span ng-if="doc.when_signature_provided">Signed offline and uploaded</span>
                                    <span>{{doc.when_signed  | date:settings.dateandtime}}</span>
                                </span>
                            </div>
                            <div class="inforow" ng-if="doc.when_shared && !doc.when_signed && navState.role == 'issuer' && doc.signature_flow > 0 && !doc.issue">
                                <span class="activity-icon doc-upload-red-icon"></span>
                                <span class="info" ng-if="!uploading">
                                    <span>{{doc.name}} has not signed this document. Do you wish to upload a signed copy?</span><span></span>
                                    <div class="fileInputContainer">
                                        <input multiple type="file" class='file'
                                            accept=".pdf,.doc,.docx,.ppt,.pptx,.odt,.odp,.odi,.png,.tiff,.jpg,.txt,.rdf"
                                            onchange="angular.element(this).scope().setSignedFiles(this);"/>
                                        <div class="fakefile">
                                            <div class="small-standard-button darkgray">
                                                <button class="btn">Upload</button>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                                <span class="info" ng-if="uploading">
                                    <span>Uploading signed copy now . . . </span><span></span>
                                </span>
                            </div>
                            <div class="inforow" ng-if="doc.when_countersigned">
                                <span class="activity-icon doc-final-icon"></span>
                                <span class="info"><span>Approved</span><span>{{doc.when_countersigned  | date:settings.dateandtime}}</span></span>
                            </div>
                            <div class="inforow" ng-if="doc.when_retracted">
                                <span class="activity-icon doc-retract-icon"></span>
                                <span class="info"><span>Retracted</span><span>{{doc.when_retracted  | date:settings.dateandtime}}</span></span>
                            </div>
                            <div class="inforow" ng-if="doc.when_void_requested">
                                <span class="activity-icon doc-void-request-icon"></span>
                                <span class="info"><span>Void requested</span><span>{{doc.when_void_requested  | date:settings.dateandtime}}</span></span>
                            </div>
                            <div class="inforow" ng-if="doc.when_void_accepted">
                                <span class="activity-icon doc-void-accept-icon"></span>
                                <span class="info" ng-if="navState.role == 'issuer'"><span>Void accepted by {{doc.name}}</span><span>{{doc.when_void_requested  | date:settings.dateandtime}}</span></span>
                                <span class="info" ng-if="navState.role == 'investor'"><span>Void accepted</span><span>{{doc.when_signed  | date:settings.dateandtime}}</span></span>
                            </div>
                        </div>
                        <div ng-if="prepareable()">
                            <doc-transaction-details doc="doc"></doc-transaction-details>
                        </div>
                        <help-tab doc="doc"></help-tab>
                    </tab>
                    <tab active="annottab" heading="Annotations" ng-if="prepareable() || prepareFor || actionNeeded()">
                        <annotation-list doc="doc" active="active" prepare-for="prepareFor"></annotation-list>
                    </tab>
                    <tab heading="Transactions" ng-if="doctrans.length > 0">
                        <doc-transaction-list trans="doctrans"></doc-transaction-list>
                    </tab>
                </tabset>
                <div id="bottom-part" class="confirmPanelContainer" ng-if="prepareable() || prepareFor || actionNeeded()">
                    <div class="confirmPanel">
                        <doc-action approve-action="signDocument()" approve-verb="Sign" ng-if="invq && doc.signable()" disabled="unfilledAnnotation()">
                            By clicking "Sign", you are creating a legally binding contract between the other party and yourself, or the entity you are authorized to represent. This action is irreversible.
                        </doc-action>

                        <doc-action upgrade-warning="true" approve-action="countersignDocument()" approve-verb="Approve" rejectable="true" reject-action="rejectSignature(message)" ng-if="!invq && doc.countersignable(navState.role)" disabled="unfilledAnnotation()">
                            By clicking "Approve", you are creating a legally binding contract between the other party and yourself, or the entity you are authorized to represent.
                        </doc-action>

                        <doc-action upgrade-warning="true" approve-action="finalizeDocument()" approve-verb="Approve" rejectable="true" reject-action="rejectSignature(message)" ng-if="!invq && doc.finalizable()">
                            Approve signature and finalize this document.
                        </doc-action>

                        <doc-action approve-action="confirmVoid()" approve-verb="Void" rejectable="true" reject-action="rejectVoid(message)" ng-if="invq && doc.voidable()">
                            Accept the voiding of this document.
                        </doc-action>

                        <doc-action approve-action="signTemplate()" approve-verb="Sign" ng-if="invq && templateKey">
                            By clicking "Sign", you are creating a legally binding contract between the other party and yourself, or the entity you are authorized to represent. This action is irreversible.
                        </doc-action>
                    </div>
                    <div ng-if="prepareFor" class="sides-padded bottom-padded">{{prepareFor}} version</div>
                    <div ng-if="(invq && doc.signable()) || prepareFor" class="fields-progress">
                        <span ng-show="doc.numAnnotationsComplete(navState.role, prepareFor) != doc.numAnnotations(navState.role)">{{doc.numAnnotationsComplete(navState.role, prepareFor)}}/{{doc.numAnnotations(navState.role)}} Complete</span>
                        <span ng-show="doc.numAnnotationsComplete(navState.role, prepareFor) == doc.numAnnotations(navState.role)">Document is ready!</span>
                        <meter cur="doc.numAnnotationsComplete(navState.role, prepareFor)" tot="doc.numAnnotations(navState.role)"></meter>
                    </div>
                    <div ng-if="prepareable()" class="sides-padded bottom-padded">When you've finished adding annotations select the green button below to return to the prepare screen.</div>
                    <div ng-if="prepareable() || prepareFor" class="standard-button pull-left sides-padded bottom-padded"><button class="btn" ng-click="leave()">Finished <span class="lower-icon" data-icon="&#xe016;"></button></div>
                </div>
            </internal-right-rail>
        </div>
    </div>
</div>
